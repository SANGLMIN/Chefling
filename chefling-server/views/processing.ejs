<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 위 3개의 메타 태그는 *반드시* head 태그의 처음에 와야합니다; 어떤 다른 콘텐츠들은 반드시 이 태그들 *다음에* 와야 합니다 -->
    <title>Chefling</title>

    <!-- 부트스트랩 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link href="nav.css" rel="stylesheet">
  </head>
  <body>
    <body>

        <div class="container">
    
          <div class="masthead">
            <h3 class="text-muted">Chefling</h3>
            <nav>
              <ul class="nav nav-justified">
                <li><a href="/">Restaurant Status</a></li>
                <li><a href="/orders">Orders</a></li>
                <li class="active"><a href="/processing">Processing</a></li>
               
              </ul>
            </nav>
          </div>
    
          <!-- Jumbotron -->
          <script src="/socket.io/socket.io.js"></script> 
          <script>
            var socket = io();
            
            socket.on('update_proc', function(data) {
              // console.log("프록: 소켓수신");
              
              $("#food_queue").empty();
              $("#cook_queue").empty();
              $("#served_queue").empty();
              var orderedInsert = [];
              var cookInsert = [];
              var servedInsert = [];
              //ordered_list
              var orderIndex =0;
              var cookIndex =0;
              var servedIndex = 0;
              orderedInsert[orderIndex++] = '<div class = "col-md-3"><table class = "table table-condensed table-hover"> <th class="active">요리</th>';
              data[1].forEach(food => {
                data[3].forEach(time =>{
                  if(time[1] == food[1]){
                    orderedInsert[orderIndex++] = '<tr><td><b>'+food[3][0]+'</b> ('+food[1]+')'+'<br><font color = "blue">'+ time[3]/10+'</font>분후 조리예정'+'<br>'+'조리시작까지 <font color = "red">'+time[2]+'</font>개 남음'+'</td><tr>';
                  }
                });                
              });
              orderedInsert[orderIndex++] = '</table></div>';
              
              //cook_list
              // a[1] - cook 별 (요리사 이름, 포지션, 역량, 현재 쿸 리스트(None), 쿡시간(None), 블락유무(None) (쿡큐) 
              //각 요리는 [오더아이디, food_id, (음식이름,소요시간)]
              data[0].forEach(cook =>{
                if(cook[5]==true){
                  cookInsert[cookIndex++] = '<div class = "col-md-2"><table class = "table table-condensed table-hover"> <th bgcolor = "#F5A9A9">'+ cook[0] +'[ '+cook[1]+' ] '+'('+cook[2]+')'+'</th>';
                    console.log("red");
                  }
                else{
                  cookInsert[cookIndex++] = '<div class = "col-md-2"><table class = "table table-condensed table-hover"> <th class="active">'+ cook[0] +'[ '+cook[1]+' ] '+'('+cook[2]+')'+'</th>';
                    console.log("not red");
                  }
                cook[3].forEach(food =>{
                  cookInsert[cookIndex++] = '<tr><td>'+food[3][0]+' ('+food[1]+')'+'</td><tr>';
                });
                cookInsert[cookIndex++] = '</table></div>';
              });

              //served_list
              servedInsert[servedIndex++] = '<div class = "col-md-3"><table class = "table table-condensed table-hover"> <th class="active">요리</th>';
              data[2].forEach(food=>{
                servedInsert[servedIndex++] = '<tr><td>'+food.foodName+'<br>'+food.cookName+'<br>'+food.foodId+'<br>'+food.cookedTime+'</td><tr>';          
              });
              servedInsert[servedIndex++] = '</table></div>';

              // 동적 html 적용
              $("#food_queue").append(orderedInsert.join(''));
              $("#cook_queue").append(cookInsert.join(''));
              $("#served_queue").append(servedInsert.join(''));

            });
          </script>
    
          <!-- Example row of columns -->
          <div class="row">
            <h1>실시간 음식 조리 현황</h1>
          </div>
          <div class = "row">
            <br>
          </div>

          <div class = "row">
            <h3>해야할 요리들</h3>
            <div id = "food_queue">              
                <div class = "col-md-3">
                  <table class="table table-condensed table-hover">
                    <th class="active">요리</th>
                    <%proc_list[1].forEach(function (food) {
                      proc_list[3].forEach((time)=>{
                        if(time[1]==food[1]){%>
                        <tr>
                          <td><b><%= food[3][0]%></b> (<%=food[1]%>) <br><font color = "blue"><%=time[3]/10%></font>분후 조리예정<br>조리시작까지 <font color = "red"><%=time[2]%></font>개 남음</td>                
                        </tr>
                        <%}%> 
                      <%});%>                    
                    <%})%>
                  </table>
                </div>
              
            </div>
          </div>

          <div class = "row">
            <h3>요리사별 현황</h3>
            <div id = "cook_queue">              
              <%proc_list[0].forEach(function(cook) {%>
                <div class="col-md-2">
                  <table class="table table-condensed table-hover">
                    <%if(cook[5]==true){%>
                      <th bgcolor = "#F5A9A9"> <%=cook[0]%> [ <%=cook[1]%> ] (<%=cook[2]%>)</th>  
                    <%} else{%>
                    <th class="active"> <%=cook[0]%> [ <%=cook[1]%> ] (<%=cook[2]%>)</th> 
                    <%}%>                   
                      <%
                      cook[3].forEach(food => {%>                        
                        <tr>
                         <td><%=food[3][0]%> (<%=food[1]%>)</td>                
                        </tr> 
                      <%});%>
                  </table>
                </div>
              <%})%>

            </div>
          </div>

          <div class = "row">
            <h3>완료된 요리</h3> 
            <div id = "served_queue">                       
                <div class="col-md-3">
                  <table class="table table-condensed table-hover">
                    <th class="active">요리</th>
                    <%proc_list[2].forEach(function(food) {%>
                      <tr>
                        <td> <%=food.foodName%><br><%=food.cookName%><br><%=food.foodId%><br><%=food.cookedTime%></td>
                        </tr>
                      <%});%>
                    </table>
                  </div>
               
              

            </div>
          </div>
    
          <!-- Site footer -->
          <footer class="footer">
            <p>&copy; Chefling (Capstone team 12)</p>
          </footer>
    
        </div> <!-- /container -->
    
    <!-- jQuery (부트스트랩의 자바스크립트 플러그인을 위해 필요합니다) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- 모든 컴파일된 플러그인을 포함합니다 (아래), 원하지 않는다면 필요한 각각의 파일을 포함하세요 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  </body>
</html>